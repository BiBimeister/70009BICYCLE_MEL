<!DOCTYPE html>
<html>
<head>
	<title>Bicycles</title>

	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Bootstrap CSS-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

	<!--Google Font CSS-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Teko">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Questrial">
	
	<!--Website CSS-->
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="letter.css">
	<link rel="stylesheet" href="tooltip.css">
	<!--Website Js-->
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/easing.js"></script>
	<script type="text/javascript" src="js/move-top.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script> <!--letter-->

	<!-- Mapbox CSS -->
	<link rel="stylesheet" href="mapbox.css">
	<!-- Mapbox Js-->
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />

	
	<link rel="stylesheet" href="fwslider.css" media="all">
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/css3-mediaqueries.js"></script>
	<script src="js/fwslider.js"></script>
	
</head>
<body>

<!--1st Screen-->
<div id="screen1">
	<div class="mask">
	
	<!--Title & Menu-->
	<div class="container-fluid navbar1">
		<div class="row">
			<div class="col-sm-1"><img src="Images/BicycleLogo.png" alt="Logo" width="120px" height="120px"></div>
			<div class="col-sm-8"> 
				<div id="main-title" class="ml10">
				<span class="text-wrapper">
				<span class="letters" style="color: #375511"> Let's Bicycle! </span></span>
				</div>
				<div id="group-mem-names">Melbourne Bicycle Guide in 2020</div>
				</div>	
			<div class="col-sm-3" class="weather-wdiget">
<a class="weatherwidget-io" href="https://forecast7.com/en/n37d81144d96/melbourne/" data-font="Fira Sans" data-icons="Climacons Animated" data-days="3" data-theme="beige" data-basecolor="#899a87" data-textcolor="#f1eee5" data-highcolor="#f1eee5" data-lowcolor="#f1eee5" data-suncolor="#f3d07b" data-mooncolor="#f1eee5" data-cloudcolor="#f1eee5" data-raincolor="#f1eee5" data-snowcolor="#f1eee5" >MELBOURNE WEATHER</a>
<script>
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
</script>
				</div>		
			</div>
		</div>
		
		<div class="row" id="menu-bar" class="navbar-fixed-top">
			<div class="col-sm-2"></div>
			<div class="col-3 menu-items"><a href="#menu-bar" class="scroll"> Home </a></div>
			<div class="col-3 menu-items"><a href="#screen2" class="scroll"> Map </a></div>
			<div class="col-3 menu-items"><a href="#screen3" class="scroll"> Report </a></div>
			<div class="col-1"></div>
		</div>
	</div>
	
	<!--After Menu-->
	<div class="nav-container">>
	<div class="container-fluid">
		<div class="row" style="margin-top: 25px">		
			<div class="col-sm-1"></div>
			<div class="col-8"> <span class="title-design"> Explore Cycling in Melbourne </span></div>
			<div class="col-3"></div>
		</div>
		<div class="row" style="margin-top: 20px">	
			<div class="col-sm-1"></div>
			<div class="col-sm-5 ana-text">In March 2017, bicycles made up <font size="5" color="#e6e6e6" >16%</font> of all vehicle movements into the city in the morning peak period (between 7am and 10am). 
			In March 2008 the figure was <font size="5" color="#e6e6e6" >9%</font>. On key routes bicycles made up a significant percentage of all vehicles entering the central city in the one-hour morning peak (8am to 9am). 
			Number and percentage of bikes entering the central city from 8am to 9am, March 2017.</div>
			<div class="col-sm-5 ana-viz">Some viz</div>
			<div class="col-sm-1"></div>
		</div>
	</div>
	</div>
	</div>
</div>

<!--1.5 Screen Slider-->
<div id="screen1-5">		
		<!----start-images-slider---->
		<div class="col-sm-12" class="images-slider">
			<!-- start slider -->
		    <div id="fwslider">
		        <div class="slider_container">
		            <div class="slide"> 
					<img src="Images/slideimage0.jpg" alt=""/>
		            </div>
		            <!-- /Duplicate to create more slides -->
		            <div class="slide">
		            <img src="Images/slideimage1.jpg" alt=""/>
		            </div>
		            <div class="slide">
		            <img src="Images/slideimage2.jpg" alt=""/>		               
		            </div>
		            <!--/slide -->
		        </div>
		        <div class="timers"> </div>
		        <div class="slidePrev"><span> </span></div>
		        <div class="slideNext"><span> </span></div>
		    </div>
		    
</div>
	<div class="container-fluid">		
	</div>
</div>

<!--2nd Screen MAP-->
<div id="screen2">
	<div class="mapbox-wrapper">
	<div class="title-design">
			<div class="col-sm-12"> MAP </div>			
	</div>
		<div id="map"></div>	
		<div id="map-menu"></div>
		<div id="map-feature"></div>
		<div id="featureType" style="visibility: hidden;"> -1 </div>
	</div>
</div>

<!--3rd Screen Report-->
<div id="screen3">
	<div class="container-fluid" style="padding: 0px">
		<div class="title-design">
			<div class="col-sm-12"> The Stats! </div>			
		</div>		
	</div>
</div>

<div id="footer">

		<div class="container-fluid">
		<div class="row">
 			<div class="col-md-12">	
				<div class="footer-info">
					<p>GEOM90007 GROUP 26</p>
					<p> Mingdong XU | Tiana Chimbaikar | Tianzhi Li | Xianxhe Tong | Zhiyuan Shen </p>	
				</div>
				<hr />
				<div class="copy-right">
				<span>Copyright &copy; 2020-2021. The University of Melbourne</span>
				</div>
			</div>
		</div>
    </div>
</div>


<div id="about-us" style="display: block;"><span style="opacity: 1;"></span></div>
<a href="#" id="toTop" style="display: block;"><span id="toTopHover" style="opacity: 1;"></span></a>

	<!--Scripts-->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/easing.js"></script>
	<script type="text/javascript" src="js/move-top.js"></script>
	<script type="text/javascript" src="js/jquery.cslider.js"></script>
	<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>


 <!-- scroll_top_botton -->	
	<script type="text/javascript">
			$(document).ready(function() {
			
				var defaults = {
		  			containerID: 'toTop', // fading element id
					containerHoverID: 'toTopHover', // fading element hover id
					scrollSpeed: 1200,
					easingType: 'linear' 
		 		};
				
				
				$().UItoTop({ easingType: 'easeOutQuart' });
				
			});
	</script> 
	
<!--scroll smooth-->
	<script type="text/javascript">
		jQuery(document).ready(function($) {
			$(".scroll").click(function(event){		
				event.preventDefault();
				$('html,body').animate({scrollTop:$(this.hash).offset().top},1200);
			});
		});
	</script>

<!--title animation-->
	<script type="text/javascript">
	var textWrapper = document.querySelector('.ml10 .letters');
	textWrapper.innerHTML = textWrapper.textContent.replace(/\S/g, "<span class='letter'>$&</span>");

	anime.timeline({loop: true})
	  .add({
		targets: '.ml10 .letter',
		rotateY: [-90, 0],
		duration: 1300,
		delay: (el, i) => 60 * i
	  }).add({
		targets: '.ml10',
		opacity: 0,
		duration: 1000,
		easing: "easeOutExpo",
		delay: 1000
	  });
	</script>

<!-- mapbox part-->
	<script type="text/javascript">
		mapboxgl.accessToken = 'pk.eyJ1IjoidGlhbnpoaXBlbmdmZWkiLCJhIjoiY2tleHNiZnFqMzJiMDJxbGdtb3cxdnZjNCJ9.y_c9Bp7uXK3tQvaCrp3kCw';
		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/tianzhipengfei/ckgnja5mz050t19nyuqxao4gp',
			zoom: 14,
			center: [144.955184, -37.832555]
		});

		var volumeData = {
			"type": "geojson", "data": {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.96138, -37.81992], [144.960053, -37.825963], [144.970126, -37.823317], [144.967438, -37.817448], [144.963791, -37.809612]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.957006, -37.825213], [144.955046, -37.8211], [144.954158, -37.819073], [144.951431, -37.81321]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.935898, -37.80994], [144.944713, -37.815089], [144.947427, -37.821009], [144.952186, -37.824209]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.947479, -37.823795], [144.947632, -37.822382], [144.947427, -37.821009]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.973917, -37.818424], [144.977808, -37.823105], [144.97644, -37.823025]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.955046, -37.8211], [144.957546, -37.820346], [144.967438, -37.817448], [144.972394, -37.816005], [144.974854, -37.815277]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.947427, -37.821009], [144.954158, -37.819073], [144.973964, -37.813323]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.970248, -37.818619], [144.973917, -37.818424]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.972394, -37.816005], [144.968765, -37.808155]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.974854, -37.815277], [144.973964, -37.813323], [144.973053, -37.811378], [144.972971, -37.809248]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.944713, -37.815089], [144.951431, -37.81321], [144.953873, -37.812531], [144.956451, -37.811749], [144.958847, -37.811039], [144.961361, -37.810334], [144.963791, -37.809612], [144.966278, -37.808903], [144.968765, -37.808155]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.959, -37.787979], [144.957474, -37.799747], [144.963791, -37.809612]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.983541, -37.810411], [144.975632, -37.809547], [144.972971, -37.809248]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.963226, -37.804562]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.943954, -37.800289], [144.93885, -37.795421]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.951172, -37.796627], [144.957474, -37.799747]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.93885, -37.795421], [144.939982, -37.78757]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.93885, -37.795421], [144.935852, -37.795096], [144.930987, -37.79454], [144.927689, -37.794117]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.936034, -37.788788], [144.925278, -37.787695], [144.935852, -37.795096]]}}, {"type": "Feature", "properties": {"color": "#F7455D"}, "geometry": {"type": "LineString", "coordinates": [[144.941956, -37.793993]]}}]}
		}

		map.on('load', function() {

			map.loadImage('http://tianzhipengfei.xin/static/cycle.png', (error, image) => {
				if (error) throw error;
				map.addImage('park_image', image);
			});

			map.loadImage('http://tianzhipengfei.xin/static/placeholder.png', (error, image) => {
				if (error) throw error;
				map.addImage('dock_image', image);
			});

			map.loadImage('http://tianzhipengfei.xin/static/shopping.png', (error, image) => {
				if (error) throw error;
				map.addImage('shop_image', image);
			});

			// add source and layer for volume
			// map.addSource('volume', volumeData);
			// map.addLayer({
			// 	'id': 'volume',
			// 	'type': 'line',
			// 	'source': 'volume',
			// 	'layout': {
			// 			// make layer visible by default
			// 			'visibility': 'visible'
			// 		}
			// 	});

				// add source and layer for bicycle stops
			map.addSource('stops', {
				type: 'vector',
				url: 'mapbox://tianzhipengfei.437a9quc'
			});
			map.addLayer({
				'id': 'stops',
				'type': 'symbol',
				'source': 'stops',
				'source-layer': 'preprocessed_stop1-dqalw3',
				'layout': {
						// make layer visible by default
						'visibility': 'visible',
						'icon-image': 'park_image',
						'icon-size': 0.3
					}
				});

			// add source and layer for bicycle shops
			map.addSource('shops', {
				type: 'vector',
				url: 'mapbox://tianzhipengfei.9158xwfd'
			});
			map.addLayer({
				'id': 'shops',
				'type': 'symbol',
				'source': 'shops',
				'source-layer': 'bike_shop_2019-89iw44',
				'layout': {
					// make layer visible by default
					'visibility': 'visible',
						'icon-image': 'shop_image',
						'icon-size': 0.45
				}
			});

			// add source and layer for bicycle shared docks
			map.addSource('docks', {
				type: 'vector',
				url: 'mapbox://tianzhipengfei.3ccc2p6y'
			});


			map.addLayer({
				'id': 'docks',
				'type': 'symbol',
				'source': 'docks',
				'source-layer': 'Bike_Share_Dock_Locations-3loyal',
				'layout': {
					// make layer visible by default
					'visibility': 'visible',
						'icon-image': 'dock_image',
						'icon-size': 0.45
				}
			});

			// map.addSource('crashes',{
			// 	type:'vector',
			// 	url:'mapbox://tianzhipengfei.cvhxe4pc'
			// })

			// map.addLayer({
			// 	'id':'day_crashes',
			// 	'type':'circle',
			// 	'source':'crashes',
			// 	'source-layer':'Crashes_mingdong-21jy40',
			// 	layout:{
			// 		visibility:'visible'
			// 	},
			// 	'filter':[
			// 		'all',
			// 		['!=','Bicyclist',0],
			// 		['==','Light Condition','Day'||'Dusk/Dawn']
			// 	],
			// 	"paint":{
			// 		"circle-color":"#e33b3b",
			// 		"circle-radius":3,
			// 		"circle-opacity":0.8
			// 	}
			// })

			// map.addLayer({
			// 	'id':'night_crashes',
			// 	'type':'circle',
			// 	'source':'crashes',
			// 	'source-layer':'Crashes_mingdong-21jy40',
			// 	layout:{
			// 		visibility:'visible'
			// 	},
			// 	'filter':[
			// 		'all',
			// 		['!=','Bicyclist',0],
			// 		['!=','Light Condition','Day'||'Dusk/Dawn']
			// 	],
			// 	"paint":{
			// 		"circle-color":"#0f77ff",
			// 		"circle-radius":3,
			// 		"circle-opacity":0.8
			// 	}
			// });

			// enumerate ids of the layers
			// var toggleableLayerIds = ['stops', 'volume', 'shops', 'docks', 'day_crashes', 'night_crashes'];
			var toggleableLayerIds = ['stops', 'shops', 'docks'];
			var featuresLayerIds = ['FIND STOPS', 'FIND SHOPS', 'FIND DOCKS']


			// Add geolocate control to the map.
			var geolocate = new mapboxgl.GeolocateControl({
				positionOptions: {
					enableHighAccuracy: true
				},
				trackUserLocation: false
			});
			// Add the control to the map.
			map.addControl(geolocate);
			// Set an event listener that fires
			// when a geolocate event occurs.
			geolocate.on('geolocate', function(position) {
				const latitude = position.coords.latitude;
				const longitude = position.coords.longitude;
				var featureType = document.getElementById('featureType').value;
				console.log(featureType)	
				document.getElementById('featureType').value = -1
			});

			// set up the corresponding toggle button for each layer
			for (var i = 0; i < toggleableLayerIds.length; i++) {
				var id = toggleableLayerIds[i];

				var link = document.createElement('a');
				link.href = '#';
				link.className = 'active';
				link.textContent = id;

				link.onclick = function(e) {
					var clickedLayer = this.textContent;
					e.preventDefault();
					e.stopPropagation();

					var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
					

					// toggle layer visibility by changing the layout object's visibility property
					if (visibility === 'visible') {
						map.setLayoutProperty(clickedLayer, 'visibility', 'none');
						this.className = '';
					} else {
						this.className = 'active';
						map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
					}
				}
				var layers = document.getElementById('map-menu');
				layers.appendChild(link);
			}

			for (var i = 0; i < featuresLayerIds.length; i++) {
				var id = featuresLayerIds[i];
			
				var link = document.createElement('a');
				link.className = 'active';
				link.textContent = id;

				link.onclick = function(e) {
					console.log(e.srcElement.outerText)
					var targetType = document.getElementById('featureType').value = e.srcElement.outerText
					if (targetType == -1){
						geolocate.trigger()
						return 
					}
					var data = null
					// find nearest stops 
					if(targetType == "FIND STOPS"){
						data = map.querySourceFeatures("stops");
					}
					// find nearest stops 
					else if(targetType == "FIND SHOPS"){
						data = map.querySourceFeatures("shops");
					}
					// find nearest stops 
					else if(targetType == "FIND DOCKS"){
						data = map.querySourceFeatures("docks");
					}

					console.log(data)
				}
				var layers = document.getElementById('map-feature');
				layers.appendChild(link);
			}
		})
	</script>
</body>
</html>