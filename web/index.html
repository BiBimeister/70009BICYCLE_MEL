<!DOCTYPE html>
<html>
<head>
	<title>Welcome to Let's Bicycle!</title>

	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Bootstrap CSS-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

	<!--Google Font CSS-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Teko">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Questrial">
	
	<!--Website CSS-->
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="letter.css">
	<!--Website Js-->
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/easing.js"></script>
	<script type="text/javascript" src="js/move-top.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script> <!--letter-->

	<!-- Mapbox CSS -->
	<link rel="stylesheet" href="mapbox.css">
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
	<!-- Mapbox Js-->
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
	<script src="mapbox-gl-compare.js"></script>
	<!-- Mapbox Compare -->
	<link rel="stylesheet" href="mapbox-gl-compare.css">

	<!-- Turf Js -->
	<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>

	<!-- Data Js -->
	<script language=javascript src='./data.js'></script>	
	<link rel="stylesheet" href="fwslider.css" media="all">
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/css3-mediaqueries.js"></script>
	<script src="js/fwslider.js"></script>
	
</head>
<body>

<!--1st Screen-->
<div id="screen1">
	<div class="mask">
	
	<!--Title & Menu-->
	<div class="container-fluid navbar1">
		<div class="row">
			<div class="col-sm-1"><img src="Images/BicycleLogo.png" alt="Logo" width="120px" height="120px"></div>
			<div class="col-sm-8"> 
				<div id="main-title" class="ml10">
				<span class="text-wrapper">
				<span class="letters" style="color: #375511"> Let's Bicycle! </span></span>
				</div>
				<div id="group-mem-names">Melbourne Bicycle Guide in 2020</div>
				</div>	
			<div class="col-sm-3" class="weather-wdiget">
<a class="weatherwidget-io" href="https://forecast7.com/en/n37d81144d96/melbourne/" data-font="Fira Sans" data-icons="Climacons Animated" data-mode="Current" data-days="3" data-theme="beige" data-basecolor="#899a87" data-textcolor="#f1eee5" data-highcolor="#f1eee5" data-lowcolor="#f1eee5" data-suncolor="#f3d07b" data-mooncolor="#f1eee5" data-cloudcolor="#f1eee5" data-raincolor="#f1eee5" data-snowcolor="#f1eee5" >MELBOURNE WEATHER</a>
<script>
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
</script>
				</div>		
			</div>
		</div>
		
		<div class="row" id="menu-bar" class="navbar-fixed-top">
			<div class="col-sm-2"></div>
			<div class="col-3 menu-items"><a href="#menu-bar" class="scroll"> Home </a></div>
			<div class="col-3 menu-items"><a href="#screen2" class="scroll"> Map </a></div>
			<div class="col-3 menu-items"><a href="#screen3" class="scroll"> Report </a></div>
			<div class="col-1"></div>
		</div>
	</div>
	
	<!--After Menu-->
	<div class="nav-container">
	<div class="container-fluid">
		<div class="row" style="margin-top: 25px">		
			<div class="col-sm-1"></div>
			<div class="col-8"> <span class="title-design"> Explore Cycling in Melbourne </span></div>
			<div class="col-3"></div>
		</div>
		<div class="row" style="margin-top: 20px">	
			<div class="col-sm-1"></div>
			<div class="col-sm-5 ana-text">No matter who you are, local citizens or the state government. The website always gives information that you need. <br><br>If you cycle, explore the stores or find a stop for your bike and find your fastest way to your destination. If you are the state government, the data graphs and the map views will help you improve the cycling experience in Melbourne. <br><br>Enjoy your cycling in Melbourne!<br></div>
	</div>
	</div>
	</div>
</div>
<!--2nd Screen MAP-->
<div id="screen2">
	<div class="container-fluid" style="padding: 0px; overflow: hidden;">
		<div class="row divider"></div>
		<div class="title-design">
			<div class="row"><div class="col-sm-12"> MAP </div></div>			
		</div>
		<div class="mapbox-wrapper">
		<div class="light-guide" >
		</div>
		<div class="volume-guide" >
			<p> Discover bicycle density >>></p>
		</div>
		<div id="comparison-container" style="margin-top: -45px;">
			<div id="before-map" class="map"></div>
			<div id="after-map" class="map"></div>
		</div>
		<div id="map-menu"></div>
		<div id="map-feature"></div>
		<div class='map-overlay' id='legend'></div>
		<div id="featureType" style="visibility: hidden;"> -1 </div>

		</div>
	</div>
</div>

<div class="container-fluid"><div class="row divider"></div></div>


<!--3rd Screen Report-->
<div id="screen3">
    <div class="container-fluid" style="padding: 0px; overflow: hidden;">
        <div class="row title-design">
            <div class="col-sm-12"> The Stats! 
            </div>           
        </div>

        <!--Participation-->
        <div class="stats-mask">
            <div class="container-fluid">

	            <div class="row">
	                <div class="col-sm-4 sub-title"> 1. Participation </div>
	                <div class="col-sm-8"></div>
	            </div>

	            <div class="row">
	                <div class="col-sm-1"></div>
	                <div class="col-sm-5"><div class="participate-title">What is common transportation for work and trip?</div></div>
	                <div class="col-sm-5"><div class="participate-title">How many people participate cycling?</div></div>
	                <div class="col-sm-1"> </div>   
	            </div>

	            <div class="row">
	                <div class="col-sm-1"> </div>
	                <div class="col-sm-5"><img src="Images/BicycleUser.png" alt="Logo" style=" height: 100%; width: 100%; object-fit: contain"></div>
	                <div class="col-sm-5"><img src="Images/BicyclePop.png" alt="Logo" style=" height: 100%; width: 100%; object-fit: contain"> </div>
	                <div class="col-sm-1"> </div>
	            </div>

	            <div class="row">
	                <div class="col-sm-1"></div>
	                <div class="col-sm-5"><div class="participate-text">The purpose of cycling can be divided into weekday trip and cycling to work. The percentage of people who cycling during the two purposes keeps unchanged, which is 2%. （The change of percentages of different way to travel from weekday trip to cycling to work shows that people, who chooses not to take public transport when taking weekday trips, choose to walk instead of cycling.）</div></div>
	                <div class="col-sm-5"><div class="participate-text">The charts show the information of cycling in Melbourne, from the perspective of participation, purpose, gender and age.From the chart of participation of cycle, it can be seen that from 2011-2019, the percentage of people who had participated in cycling in the last one year keeps decreasing.</div></div>
	                <div class="col-sm-1"> </div>
	            </div>

	            <div class="row">
	                <div class="col-sm-1"></div>
	                <div class="col-sm-5"><div class="participate-title">Man or woman likes cycling?</div></div>
	                <div class="col-sm-5"><div class="participate-title">Who go cycling more?</div></div>
	                <div class="col-sm-1"> </div>   
	            </div>

	            <div class="row">
	                <div class="col-sm-1"> </div>
	                <div class="col-sm-5"><img src="Images/GenderBicycle.jpeg" alt="Logo" style=" height: 100%; width: 100%; object-fit: contain"></div>
	                <div class="col-sm-5"><img src="Images/BicycleAge.png" alt="Logo" style=" height: 90%; width: 90%; object-fit: contain"> </div>
	                <div class="col-sm-1"> </div>
	            </div>

	            <div class="row" style="padding-bottom: 10vh">
	                <div class="col-sm-1"></div>
	                <div class="col-sm-5"><div class="participate-text">Tthe percentage of males who had participated in cycling in the last one year is higher than of females, which is around 40% to 30%. </div></div>
	                <div class="col-sm-5"><div class="participate-text">The age is grouped into five groups, people aged from 0-19 have a 70% cycling participation, approximately, while the percentage of 18-49 is 35%, and 50+ is under 20%.</div></div>
	                <div class="col-sm-1"> </div>
	            </div>

	            <div class="row divider"></div>
        	</div>     
		</div>
		<div class="stats-mask">
		<!-- Tableau Bicycle Crashes Melbourne-->

			<div class="container-fluid">
			    <div class="row">
			        <div class="col-sm-4 sub-title"> 2. Accident Report </div>
			        <div class="col-sm-8"></div>
			    </div>

			    <div class="row"> 
			        <div class="col-sm-12 stats-title"> -Bicycle Crashes Melbourne- 
			        </div>
			    </div>

			    <div class="row stats-row">
			        <div class="col-sm-12">
			            <div class="tableauPlaceholder" id="viz1603980754400" style="position: relative; display: block; justify-content: center; width: 100%; height: 576px; overflow: hidden;">
			            	<noscript>
			            		<a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Bi&#47;BicycleCrashesMelbourne&#47;Dashboard4&#47;1_rss.png' style='border: none'></a>
			            	</noscript>
			            	<script src="https://public.tableau.com/javascripts/api/viz_v1.js">
			            	</script>
			            	<iframe frameborder="0" marginheight="0" marginwidth="0" title="数据可视化" allowtransparency="true" allowfullscreen="true" class="tableauViz" style="display: block; width: 100%; height: 576px; margin: 0px; padding: 0px; border: none;" src="https://public.tableau.com/views/BicycleCrashesMelbourne/Dashboard4?:embed=y&amp;:showVizHome=no&amp;:host_url=https%3A%2F%2Fpublic.tableau.com%2F&amp;:embed_code_version=3&amp;:tabs=no&amp;:toolbar=yes&amp;:animate_transition=yes&amp;:display_static_image=no&amp;:display_spinner=no&amp;:display_overlay=yes&amp;:display_count=yes&amp;:language=en-GB&amp;:loadOrderID=0">	
			            	</iframe>
			            </div>       
			        </div>
			    </div>
			        
			    <div class="row">
			        <div class="col-sm-1"></div>
			        <div class="col-sm-10">
			            <div class="stats-text" style="margin: 3vw 0vw">
			                <br>This tableau visualisation shows the bicycle accident sites from 2010 to 2018. <br><br>
			                From this chart users can explore the locations of bicycle accidents in Melbourne using filters such as the severity of the accident and the speed zone in which the accident occured in. <br><br>
			                Using this tool we have concluded that: <br>
			                1-Most bicycle accidents are not of a fatal severity. <br>
			                2-Majority of bicycle accidents occur in the 40-60km/h speed bracket. <br>
			                3-Bicycle accidents are more frequent in metropolitan Melbourne as compared to the rest of Victoria. This comes as no suprise as from the HeatMap of bicycle usage in the Map section of this website we can observe that bicycle usage is higher in metropolitan Melbourne. <br><br>
			            </div>
		        	</div>
			        <div class="col-sm-1"></div>
			    </div>
			</div>  

		    <div class="stats-mask" style="height: 85vh;">
			    <!-- Tableau Vehicle accidents per day of the week -->
			    <div class="row"> <div class="col-sm-12 stats-title"> When does crash usually happen? </div></div>
			    	<div class="row stats-row">
				        <div class="col-sm-8 tableu-centre">
				            <iframe frameborder="0" marginheight="0" marginwidth="0" allowtransparency="true" class="tableauViz" style="display: block; width: 55vw; height: 60vh; margin: 0px; padding: 0px; border: none;" width="50vw" height="60vh" src="https://public.tableau.com/views/Vehicleaccidentsperdayoftheweek/Week?:language=en-GB&amp;:display_count=y&amp;:origin=viz_share_link?:embed=y&amp;:showVizHome=no&amp;:hoswidtt_url=https%3A%2F%2Fpublic.tableau.com%2F&amp;:tabs=no&amp;:toolbar=no&amp;:animate_transition=yes&amp;:display_static_image=no&amp;:display_spinner=no&amp;:display_overlay=yes&amp;:display_count=yes">
				            </iframe>
				        </div>

				        <div class="col-sm-4"><div class="stats-text" style="width: 90%">
			                <br>This tableau visualisation displays the accident numbers over the last 5 years per day of the week categorised as bicycle accidents or motor vehicle accidents. <br><br>

			                We observe that following the same trend as motor vehicle accidents, bicycle accidents are more frequent on weekdays. <br><br> 
			            </div>
		            </div>
		    	</div>
		    </div>

			<div class="stats-mask" style="height: 200vh">
			    <div class="row divider"></div>
				    <div class="row">
				        <div class="col-sm-4 sub-title"> 3. Benefits </div>
				        <div class="col-sm-8"></div>
				    </div>
					<div class="row"> <div class="col-sm-12 stats-title"> -Cycling &amp; Health- </div></div>
					<div class="row">
			            <div class="col-sm-7">
			                <div class="row">
			                    <div class="col-sm-12 stats-minititle"> How bad situation we are facing? 
			                    </div>
			                </div>

			                <div class="row">
			                    <div class="col-sm-12 tableu-centre">
			                        <iframe frameborder="0" marginheight="0" marginwidth="0" allowtransparency="true" class="tableauViz" style="display: block; width: 50vw; height: 55vh; margin: 0px; padding: 0px; border: none;" width="100%" height="100%" src="https://public.tableau.com/views/PercentageofoverweightpopulationinVictoria/Dashboard2?:language=en-GB&amp;:embed_code_version=3&amp;:loadOrderID=2&amp;:display_count=y&amp;:origin=viz_share_link?:embed=y&amp;:showVizHome=no&amp;:hoswidtt_url=https%3A%2F%2Fpublic.tableau.com%2F&amp;:tabs=no&amp;:toolbar=no&amp;:animate_transition=yes&amp;:display_static_image=no&amp;:display_spinner=no&amp;:display_overlay=yes&amp;:display_count=yes"></iframe>
			                    </div>
			                </div>

			                <div class="row">
			                    <div class="col-sm-12 stats-minititle"> -Percentage of population with insufficient physical activity in Victoria- 
			                    </div>
			                </div>

			                <div class="row">
			                    <div class="col-sm-12 tableu-centre">
			                        <iframe frameborder="0" marginheight="0" marginwidth="0" allowtransparency="true" class="tableauViz" style="display: block; width: 50vw; height: 55vh; margin: 0px; padding: 0px; border: none;" width="100%" height="100%" src="https://public.tableau.com/views/PercentageofpopulationwithinsufficientphysicalactivityinVictoria/PercentageofpopulationwithinsufficientphysicalactivityinVictoriaDB?:language=en-GB&amp;:retry=yes&amp;:embed_code_version=3&amp;:loadOrderID=3&amp;:display_count=y&amp;publish=yes&amp;:origin=viz_share_link?:embed=y&amp;:showVizHome=no&amp;:hoswidtt_url=https%3A%2F%2Fpublic.tableau.com%2F&amp;:tabs=no&amp;:toolbar=no&amp;:animate_transition=yes&amp;:display_static_image=no&amp;:display_spinner=no&amp;:display_overlay=yes&amp;:display_count=yes"></iframe>
			                    </div>
			                </div>
			            </div>

			            <div class="col-sm-5 mx-auto my-auto" style="padding-right: 20px ">
			                <div class="row">
			                    <div class="col-sm-12 stats-minititle"> -Calories per kg consumed while exercising for an hour- </div>
			                </div>

			                <div class="row">
			                    <div class="col-sm-12 tableau-centre" style=" padding: 0;">
			                        <iframe frameborder="0" marginheight="0" marginwidth="0" allowtransparency="true" class="tableauViz" style="display: block; width: 36vw; height: 55vh; margin: 0px; padding: 0px; border: none;" width="100%" height="100%" src="https://public.tableau.com/views/Caloriesperkgconsumedwhileexercisingforanhour/Sheet1?:language=en-GB&amp;:embed_code_version=3&amp;:loadOrderID=4&amp;:display_count=y&amp;:origin=viz_share_link?:embed=y&amp;:showVizHome=no&amp;:hoswidtt_url=https%3A%2F%2Fpublic.tableau.com%2F&amp;:tabs=no&amp;:toolbar=no&amp;:animate_transition=yes&amp;:display_static_image=no&amp;:display_spinner=no&amp;:display_overlay=yes&amp;:display_count=yes"></iframe>
			                    </div>
			                </div>

			                <div class="row" style="width: 90%">
			                    <div class="col-sm-12" style=" padding: 5vw 0;">
			                        <div class="stats-text mx-auto my-auto" style="width: 100%; margin: 0"> 
			                        <br>Being physically healthy is a concern in Victoria. From the two maps we can see that on an average more than 40% of the population is overweight and on an average around 35% of the population is not sufficiently physically active. <br><br>

			                        From the bar chart comparing the calories burnt per kg while exercising for an hour we can see that cycling burns high calories as compared to other sports. <br><br>
			                        
			                        Consider the small cycling proportions for work and weekday trips, we’d like to suggest facilities to promote the usage of cycling in Victoria to benefit the overall population health. This would provide not only a health benefit to the individual but also an environmental one. <br><br>
			                    	</div>
			                    </div>
			                </div>
			            </div>
			        </div>
			    </div>
			    


		    <div class="stats-mask" style="height: 100vh">
		    <!-- Tableau The number of bicycle shops -->
		    	<div class="row"><div class="col-sm-12 stats-title"> How bicycle benefits our economy? </div></div>
		        <div class="row stats-row mx-auto">
			        <div class="col-sm-8 mx-auto" style=" display: flex; justify-content: center;">
			            <iframe frameborder="0" marginheight="0" marginwidth="0" allowtransparency="true" class="tableauViz" style="display: block; width: 55vw; height: 64vh; margin: 0px; padding: 0px; border: none;" width="100%" height="100%" src="https://public.tableau.com/shared/W55FQ9K65?:display_count=y&amp;:origin=viz_share_link?:embed=y&amp;:showVizHome=no&amp;:hoswidtt_url=https%3A%2F%2Fpublic.tableau.com%2F&amp;:tabs=no&amp;:toolbar=yes&amp;:animate_transition=yes&amp;:display_static_image=no&amp;:display_spinner=no&amp;:display_overlay=yes&amp;:display_count=yes"></iframe>
			        </div>
			                    

				    <div class="col-sm-4 my-auto" style="padding-left: 0"> 
				        <div class="stats-text mx-auto" style="width: 90%"> 
				            <br>From the bar chart we can observe a rising trend in the number of bicycle related businesses over the past years in the city of Melbourne. <br><br>

				            There is a significant increase in the number of bicycle businesses in 2010. This may be due to the initiation of the now infamous Melbourne Bike Share scheme by the government in the same year which may have encouraged the usage of bicycles by the public. <br><br>
				        </div>
				    </div>
			    </div>
		    </div>
		</div>
	</div>
</div>

<div id="footer">

		<div class="container-fluid">
		<div class="row">
 			<div class="col-md-12">	
				<div class="footer-info">
					<p>GEOM90007 GROUP 26</p>
					<p> Mingdong XU | Tiana Chimbaikar | Tianzhi Li | Xianxhe Tong | Zhiyuan Shen </p>	
				</div>
				<hr />
				<div class="copy-right">
				<span>Copyright &copy; 2020-2021. The University of Melbourne</span>
				</div>
			</div>
		</div>
    </div>
</div>


<a href="https://www.melbourne.vic.gov.au/parking-and-transport/cycling/Pages/bicycle-plan.aspx" target="_blank" id="left-bottom" style="display: block;" title="Click to Explore More"><span style="opacity: 1;"></span></a>
<a href="#" id="toTop" style="display: block;"><span id="toTopHover" style="opacity: 1;"></span></a>

	<!--Scripts-->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/easing.js"></script>
	<script type="text/javascript" src="js/move-top.js"></script>
	<script type="text/javascript" src="js/jquery.cslider.js"></script>
	<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>



 <!-- scroll_top_botton -->	
	<script type="text/javascript">
			$(document).ready(function() {
			
				var defaults = {
		  			containerID: 'toTop', // fading element id
					containerHoverID: 'toTopHover', // fading element hover id
					scrollSpeed: 1200,
					easingType: 'linear' 
		 		};
				
				
				$().UItoTop({ easingType: 'easeOutQuart' });
				
			});
	</script> 
	
<!--scroll smooth-->
	<script type="text/javascript">
		jQuery(document).ready(function($) {
			$(".scroll").click(function(event){		
				event.preventDefault();
				$('html,body').animate({scrollTop:$(this.hash).offset().top},1200);
			});
		});
	</script>

	<!--title animation-->
	<script type="text/javascript">
	var textWrapper = document.querySelector('.ml10 .letters');
	textWrapper.innerHTML = textWrapper.textContent.replace(/\S/g, "<span class='letter'>$&</span>");

	anime.timeline({loop: true})
	  .add({
		targets: '.ml10 .letter',
		rotateY: [-90, 0],
		duration: 1300,
		delay: (el, i) => 60 * i
	  }).add({
		targets: '.ml10',
		opacity: 0,
		duration: 1000,
		easing: "easeOutExpo",
		delay: 1000
	  });
	</script>

	<!-- mapbox part-->
	<script type="text/javascript">

		function getRoute(start, end) {
			// make a directions request using cycling profile
			// an arbitrary start will always be the same
			// only the end or destination will change
			var url = 'https://api.mapbox.com/directions/v5/mapbox/cycling/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?steps=true&geometries=geojson&access_token=' + mapboxgl.accessToken;

			// make an XHR request https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
			var req = new XMLHttpRequest();
			req.open('GET', url, true);
			req.onload = function() {
				var json = JSON.parse(req.response);
				var data = json.routes[0];
				var route = data.geometry.coordinates;
				var geojson = {
					type: 'Feature',
					properties: {},
					geometry: {
						type: 'LineString',
						coordinates: route
					}
				};
				beforeMap.getSource('route').setData(geojson);
			};
			req.send();
		}
	
		mapboxgl.accessToken = 'pk.eyJ1IjoidGlhbnpoaXBlbmdmZWkiLCJhIjoiY2tleHNiZnFqMzJiMDJxbGdtb3cxdnZjNCJ9.y_c9Bp7uXK3tQvaCrp3kCw';
		
		var beforeMap = new mapboxgl.Map({
			container: 'before-map',
			style: 'mapbox://styles/tianzhipengfei/ckgnja5mz050t19nyuqxao4gp',
			zoom: 12,
			center: [144.9629, -37.8097]
		});

		var afterMap = new mapboxgl.Map({
			container: 'after-map',
			style: 'mapbox://styles/tianzhipengfei/ckgp7nfvc2gz21aqp4xo928mt',
			zoom: 12,
			center: [144.9629, -37.8097]
		});

		var container = '#comparison-container';

		var map = new mapboxgl.Compare(beforeMap, afterMap, container, {
			// Set this to enable comparing two maps by mouse movement:
			// mousemove: true
		});

		//Listen to slider movement
		map.on('moving', (e) => {
			let cur_pos = e.currentPosition;
			if(cur_pos <= 0.15){
				var menu_wrapper = document.getElementById('map-menu')
				if(menu_wrapper.style.visibility != 'hidden')
					menu_wrapper.style.visibility = 'hidden'
				var feature_wrapper = document.getElementById('map-feature')
				if(feature_wrapper.style.visibility != 'hidden')
					feature_wrapper.style.visibility = 'hidden'
			} else if(cur_pos >= 0.85){
				var legend_wrapper = document.getElementById('legend')
				if(legend_wrapper.style.visibility != 'hidden')
				legend_wrapper.style.visibility = 'hidden'
			} else{
				var menu_wrapper = document.getElementById('map-menu')
				if(menu_wrapper.style.visibility != 'visible')
					menu_wrapper.style.visibility = 'visible'
				var feature_wrapper = document.getElementById('map-feature')
				if(feature_wrapper.style.visibility != 'visible')
					feature_wrapper.style.visibility = 'visible'
				var legend_wrapper = document.getElementById('legend')
				if(legend_wrapper.style.visibility != 'visible')
					legend_wrapper.style.visibility = 'visible'

			}
		});

		afterMap.on('load', function (){ 
			var layers = ['0-20%', '20-40%', '40-60%', '60-80%', '80-100%'];
			var colors = ['#ffe4b3', '#fecb5d', '#fd8d3c', '#fd853a', '#ff4f1f'];
			for (i = 0; i < layers.length; i++) {
				var layer = layers[i];
				var color = colors[i];
				var item = document.createElement('div');
				var key = document.createElement('span');
				key.className = 'legend-key';
				key.style.backgroundColor = color;

				var value = document.createElement('span');
				value.className = 'legend-value';
				value.innerHTML = layer;
				item.appendChild(value);
				item.appendChild(key);
				item.className = "legend-item";
				legend.appendChild(item);
			}
		})

		beforeMap.on('load', function() {

			beforeMap.loadImage('http://tianzhipengfei.xin/static/cycle.png', (error, image) => {
				if (error) throw error;
				beforeMap.addImage('dock_image', image);
			});

			beforeMap.loadImage('http://tianzhipengfei.xin/static/placeholder.png', (error, image) => {
				if (error) throw error;
				beforeMap.addImage('park_image', image);
			});

			beforeMap.loadImage('http://tianzhipengfei.xin/static/shopping.png', (error, image) => {
				if (error) throw error;
				beforeMap.addImage('shop_image', image);
			});

			beforeMap.addSource('nearest-location', {
				type: 'geojson',
				data: {
				type: 'FeatureCollection',
				features: []
				}
			});

			beforeMap.addSource('route', {
				type: 'geojson',
				data: {
					type: 'Feature',
					properties: {},
					geometry: {
					type: 'LineString',
					coordinates: []
					}
				}
			});
			beforeMap.addLayer({
				id: 'route',
				type: 'line',
				source: 'route',
				layout: {
					'line-join': 'round',
					'line-cap': 'round',
					'visibility': 'visible'
				},
				paint: {
					'line-color': '#3887be',
					'line-width': 5,
					'line-opacity': 0.75
				}
			});

			// add source and layer for bicycle stops
			beforeMap.addSource('stops', stopData);
			beforeMap.addLayer({
				'id': 'stops',
				'type': 'symbol',
				'source': 'stops',
				'layout': {
						// make layer visible by default
						'visibility': 'visible',
						'icon-image': 'park_image',
						'icon-size': 0.55
					}
				});

			// add source and layer for bicycle shops
			beforeMap.addSource('shops', shopData);
			beforeMap.addLayer({
				'id': 'shops',
				'type': 'symbol',
				'source': 'shops',
				'layout': {
					// make layer visible by default
					'visibility': 'visible',
						'icon-image': 'shop_image',
						'icon-size': 0.45
				}
			});

			// add source and layer for bicycle shared docks
			beforeMap.addSource('docks', dockData);
			beforeMap.addLayer({
				'id': 'docks',
				'type': 'symbol',
				'source': 'docks',
				'layout': {
					// make layer visible by default
					'visibility': 'visible',
						'icon-image': 'dock_image',
						'icon-size': 0.45
				}
			});

			// enumerate ids of the layers
			var toggleableLayerIds = ['Docks', 'Shops', 'Public bicycle'];
			var featuresLayerIds = ['Nearest Dock', 'Nearest Shop', 'Nearest Public bicycle']


			// Add geolocate control to the map.
			var geolocate = new mapboxgl.GeolocateControl({
				positionOptions: {
					enableHighAccuracy: true
				},
				trackUserLocation: false
			});

			// Add the control to the map.
			beforeMap.addControl(geolocate);

			// Set an event listener that fires
			// when a geolocate event occurs.
			geolocate.on('geolocate', function(position) {
				const latitude = position.coords.latitude;
				const longitude = position.coords.longitude;
				let curPoint = [longitude, latitude]
				var featureType = document.getElementById('featureType').value;
				console.log(featureType)
				if(featureType == -1){
					beforeMap.getSource('nearest-location').setData({
						type: 'FeatureCollection',
						features: []
					});
					beforeMap.getSource('route').setData({
						type: 'FeatureCollection',
						features: []
					});
					return 
				}	
				document.getElementById('featureType').value = -1

				map.setSlider(10000)

				var legend_wrapper = document.getElementById('legend')
				if(legend_wrapper.style.visibility != 'hidden')
					legend_wrapper.style.visibility = 'hidden'

				var data = null
				var origin_layer = null
				// find nearest stops 
				if(featureType == "Nearest Dock"){
					data = beforeMap.getSource("stops").serialize();
					origin_layer = "stops"
				}
				// find nearest shop 
				else if(featureType == "Nearest Shop"){
					data = beforeMap.getSource("shops").serialize();
					origin_layer = "shops"
				}
				// find nearest public bicycle 
				else if(featureType == "Nearest Public bicycle"){
					data = beforeMap.getSource("docks").serialize();
					origin_layer = "docks"
				}
				var point = {
					"type": "Feature",
					"properties": {
						"marker-color": "#0f0"
					},
					"geometry": {
						"type": "Point",
						"coordinates": curPoint
					}
				};
				var candidates = data.data
				var nearestLocation = turf.nearest(point, candidates);
				if (nearestLocation !== null) {
					// Update the 'nearest-location' data source to include
					// the nearest location

					var mapLayer = beforeMap.getLayer('nearest-location');
					if(typeof(mapLayer) !== 'undefined') {
					// Remove map layer 
						beforeMap.removeLayer('nearest-location')
					}

					beforeMap.getSource('nearest-location').setData({
						type: 'FeatureCollection',
						features: [
							nearestLocation
						]
					});

					// Create a new circle layer from the 'nearest-library' data source
					beforeMap.addLayer({
						id: 'nearest-location',
						type: 'circle',
						source: 'nearest-location',
						paint: {
							'circle-radius': 20,
							'circle-color': '#486DE0'
						}
					}, origin_layer);
					let targetPoint = nearestLocation.geometry.coordinates
					getRoute(curPoint, targetPoint);
				}
			});

			// set up the corresponding toggle button for each layer
			for (var i = 0; i < toggleableLayerIds.length; i++) {
				var id = toggleableLayerIds[i];

				var link = document.createElement('a');
				link.href = '#';
				link.className = 'active';
				link.textContent = id;

				link.onclick = function(e) {
					var clickedLayer = this.textContent;
					if(clickedLayer == 'Docks'){
						clickedLayer = 'stops'
					} else if(clickedLayer == 'Shops'){
						clickedLayer = 'shops'
					}  else if(clickedLayer == 'Public bicycle'){
						clickedLayer = 'docks'
					} 
					e.preventDefault();
					e.stopPropagation();

					var visibility = beforeMap.getLayoutProperty(clickedLayer, 'visibility');
					

					// toggle layer visibility by changing the layout object's visibility property
					if (visibility === 'visible') {
						beforeMap.setLayoutProperty(clickedLayer, 'visibility', 'none');
						this.className = '';
					} else {
						this.className = 'active';
						beforeMap.setLayoutProperty(clickedLayer, 'visibility', 'visible');
					}
				}
				var layers = document.getElementById('map-menu');
				layers.appendChild(link);
			}

			for (var i = 0; i < featuresLayerIds.length; i++) {
				var id = featuresLayerIds[i];
			
				var link = document.createElement('a');
				link.className = 'active';
				link.textContent = id;

				link.onclick = function(e) {
					var targetType = document.getElementById('featureType').value = e.srcElement.outerText
					if (targetType != -1){
						geolocate.trigger()
						return 
					}
				}
				var layers = document.getElementById('map-feature');
				layers.appendChild(link);
			}
		})
	</script>
</body>
</html>
